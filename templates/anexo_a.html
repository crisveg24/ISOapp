{% extends "base.html" %}

{% block title %}ISO 27001 - Anexo A{% endblock %}

{% block content %}
<div class="content-container">
    <div class="page-header">
        <h1><i class="fas fa-shield-alt"></i> ISO 27001 - Anexo A</h1>
        <p class="subtitle">Controles de Seguridad de la Información</p>
    </div>

    <div class="info-banner">
        <i class="fas fa-info-circle"></i>
        <div>
            <strong>Anexo A de ISO 27001:</strong>
            <p>Define controles de seguridad organizacionales, de personas y tecnológicos para proteger la información.</p>
        </div>
    </div>

    <div class="filters-section">
        <h2><i class="fas fa-filter"></i> Filtrar por Categoría</h2>
        <div class="filter-buttons">
            <button onclick="filterCategory('all')" class="btn btn-filter active" data-filter="all">
                <i class="fas fa-th"></i> Todos
            </button>
            <button onclick="filterCategory('Controles Organizacionales')" class="btn btn-filter" data-filter="org">
                <i class="fas fa-building"></i> Organizacionales
            </button>
            <button onclick="filterCategory('Controles de Personas')" class="btn btn-filter" data-filter="people">
                <i class="fas fa-users"></i> De Personas
            </button>
            <button onclick="filterCategory('Controles de Tecnología')" class="btn btn-filter" data-filter="tech">
                <i class="fas fa-laptop-code"></i> De Tecnología
            </button>
        </div>
    </div>

    <div class="table-section">
        <h2><i class="fas fa-list"></i> Controles Implementados</h2>
        <div class="table-responsive">
            <table class="data-table" id="controlsTable">
                <thead>
                    <tr>
                        <th>Categoría</th>
                        <th>Control de Seguridad</th>
                        <th>Descripción</th>
                        <th>Implementación en el Proyecto</th>
                        <th>Responsable</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in data.data %}
                    <tr data-category="{{ row[0] }}">
                        <td><span class="badge badge-{{ 'primary' if 'Organizacionales' in row[0] else 'success' if 'Personas' in row[0] else 'info' }}">{{ row[0] }}</span></td>
                        <td><strong>{{ row[1] }}</strong></td>
                        <td>{{ row[2] }}</td>
                        <td>{{ row[3] }}</td>
                        <td><span class="badge badge-secondary">{{ row[4] }}</span></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div class="summary-cards">
        <div class="summary-card">
            <i class="fas fa-building"></i>
            <h3>Controles Organizacionales</h3>
            <p id="count-org">0</p>
        </div>
        <div class="summary-card">
            <i class="fas fa-users"></i>
            <h3>Controles de Personas</h3>
            <p id="count-people">0</p>
        </div>
        <div class="summary-card">
            <i class="fas fa-laptop-code"></i>
            <h3>Controles de Tecnología</h3>
            <p id="count-tech">0</p>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Contar controles por categoría
    function countControls() {
        const rows = document.querySelectorAll('#controlsTable tbody tr');
        let org = 0, people = 0, tech = 0;
        
        rows.forEach(row => {
            const category = row.getAttribute('data-category');
            if (category.includes('Organizacionales')) org++;
            else if (category.includes('Personas')) people++;
            else if (category.includes('Tecnología')) tech++;
        });
        
        document.getElementById('count-org').textContent = org;
        document.getElementById('count-people').textContent = people;
        document.getElementById('count-tech').textContent = tech;
    }
    
    function filterCategory(category) {
        const rows = document.querySelectorAll('#controlsTable tbody tr');
        const buttons = document.querySelectorAll('.btn-filter');
        
        // Actualizar botones activos
        buttons.forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        
        // Filtrar filas
        rows.forEach(row => {
            if (category === 'all' || row.getAttribute('data-category').includes(category)) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
    }
    
    // Inicializar contadores
    countControls();
</script>
{% endblock %}
